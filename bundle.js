(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){ var NUM_BEATS = 16; var BPM = 120; var getTick = require('./src/get_tick'); var Sampler = require('./src/sampler'); var Drum = require('./src/drum'); var Oscillator = require('openmusic-oscillator'); var Synth = require('./src/synth'); var UI = require('./src/UI'); var installMarkers = UI.installMarkers; var updateMarkers = UI.updateMarkers; var createSaveLoadButtons = UI.createSaveLoadButtons; var ac = new AudioContext(); var instruments = []; var drums = ['clap', 'cym', 'hat', 'snare', 'kick']; drums.forEach(function(drum){ var sampler = new Sampler(ac, 'samples/'+drum+'.wav'); sampler.connect(ac.destination); var drum = new Drum(sampler, drum); instruments.push(drum) }) var synths = ['triangle', 'sine']; synths.forEach(function(synth){ var oscillator = new Oscillator(ac); oscillator.type = synth; oscillator.connect(ac.destination); var synthesizer = new Synth(oscillator, synth); instruments.push(synthesizer); }) var position = 0; var interval; var tick = getTick(BPM); function run(tick){ interval = window.setInterval(function(){ updateMarkers(position, NUM_BEATS); instruments.forEach(function(instrument){ instrument.play(position, ac); }) position++; if(position >= 16){ position = 0; } }, tick); }; function createSlider(run){ var slider = document.createElement("div"); slider.setAttribute("class", "bpm-slider"); var bpmInfo = document.createElement("span"); bpmInfo.setAttribute("class", "bpm-info"); bpmInfo.textContent = BPM+'bpm'; var bpmSlider = document.createElement("input"); bpmSlider.setAttribute("type", "range"); bpmSlider.setAttribute("min", 20); bpmSlider.setAttribute("max", 500); bpmSlider.oninput = function updateBPM(e){ window.clearInterval(interval); bpm = e.target.valueAsNumber; bpmInfo.textContent = bpm + 'bpm'; tick = getTick(bpm); run(tick); }; slider.appendChild(bpmSlider); slider.appendChild(bpmInfo); document.body.appendChild(slider); } installMarkers(NUM_BEATS); createSlider(run); createSaveLoadButtons(instruments); run(tick); },{"./src/UI":6,"./src/drum":7,"./src/get_tick":8,"./src/sampler":9,"./src/synth":10,"openmusic-oscillator":3}],2:[function(require,module,exports){ module.exports = int2freq var scales = { major: [2, 2, 1, 2, 2, 2, 1], minor: [2, 1, 2, 2, 1, 2, 2], pentMaj: [2, 2, 3, 2, 3], pentMin: [3, 2, 2, 3, 2] } var notes = [ 'A0', 'A#0', 'B0', 'C1', 'C#1', 'D1', 'D#1', 'E1', 'F1', 'F#1', 'G1', 'G#1', 'A1', 'A#1', 'B1', 'C2', 'C#2', 'D2', 'D#2', 'E2', 'F2', 'F#2', 'G2', 'G#2', 'A2', 'A#2', 'B2', 'C3', 'C#3', 'D3', 'D#3', 'E3', 'F3', 'F#3', 'G3', 'G#3', 'A3', 'A#3', 'B3', 'C4', 'C#4', 'D4', 'D#4', 'E4', 'F4', 'F#4', 'G4', 'G#4', 'A4', 'A#4', 'B4', 'C5', 'C#5', 'D5', 'D#5', 'E5', 'F5', 'F#5', 'G5', 'G#5', 'A5', 'A#5', 'B5', 'C6', 'C#6', 'D6', 'D#6', 'E6', 'F6', 'F#6', 'G6', 'G#6', 'A6', 'A#6', 'B6', 'C7', 'C#7', 'D7', 'D#7', 'E7', 'F7', 'F#7', 'G7', 'G#7', 'A7', 'A#7', 'B7', 'C8' ] var str2freq = { 'A0': 27.5000, 'A#0': 29.1352, 'B0': 30.8677, 'C1': 32.7032, 'C#1': 34.6478, 'D1': 36.7081, 'D#1': 38.8909, 'E1': 41.2034, 'F1': 43.6535, 'F#1': 46.2493, 'G1': 48.9994, 'G#1': 51.9131, 'A1': 55.0000, 'A#1': 58.2705, 'B1': 61.7354, 'C2': 65.4064, 'C#2': 69.2957, 'D2': 73.4162, 'D#2': 77.7817, 'E2': 82.4069, 'F2': 87.3071, 'F#2': 92.4986, 'G2': 97.9989, 'G#2': 103.826, 'A2': 110.000, 'A#2': 116.541, 'B2': 123.471, 'C3': 130.813, 'C#3': 138.591, 'D3': 146.832, 'D#3': 155.563, 'E3': 164.814, 'F3': 174.614, 'F#3': 184.997, 'G3': 195.998, 'G#3': 207.652, 'A3': 220.000, 'A#3': 233.082, 'B3': 246.942, 'C4': 261.626, 'C#4': 277.183, 'D4': 293.665, 'D#4': 311.127, 'E4': 329.628, 'F4': 349.228, 'F#4': 369.994, 'G4': 391.995, 'G#4': 415.305, 'A4': 440.000, 'A#4': 466.164, 'B4': 493.883, 'C5': 523.251, 'C#5': 554.365, 'D5': 587.330, 'D#5': 622.254, 'E5': 659.255, 'F5': 698.456, 'F#5': 739.989, 'G5': 783.991, 'G#5': 830.609, 'A5': 880.000, 'A#5': 932.328, 'B5': 987.767, 'C6': 1046.50, 'C#6': 1108.73, 'D6': 1174.66, 'D#6': 1244.51, 'E6': 1318.51, 'F6': 1396.91, 'F#6': 1479.98, 'G6': 1567.98, 'G#6': 1661.22, 'A6': 1760.00, 'A#6': 1864.66, 'B6': 1975.53, 'C7': 2093.00, 'C#7': 2217.46, 'D7': 2349.32, 'D#7': 2489.02, 'E7': 2637.02, 'F7': 2793.83, 'F#7': 2959.96, 'G7': 3135.96, 'G#7': 3322.44, 'A7': 3520.00, 'A#7': 3729.31, 'B7': 3951.07, 'C8': 4186.01 } function int2freq(intNote, options){ var index, scale; if((index = notes.indexOf(options.tonic)) === -1) throw 'what is up with that tonic?' if(!(scale = scales[options.scale])) throw 'what is up with that scale?' while (Math.abs(intNote) > scale.length) scale = scale.concat(scale) if(intNote >= 0) for (var i = 0; i < intNote; index += scale[i], i+= 1 ){} else for (var j = -1; j >= intNote; index -= scale[scale.length + j], j-= 1){} return str2freq[notes[index]] } },{}],3:[function(require,module,exports){ (function() { var DCBias = require('openmusic-dcbias'); function Oscillator(context) { var node = context.createGain(); var oscillator; var frequencySignal; var properties = {}; frequencySignal = DCBias(context); node.frequency = frequencySignal.gain; node.frequency.setValueAtTime(440, context.currentTime); ['type'].forEach(function(name) { Object.defineProperty(node, name, makePropertyGetterSetter(name)); }); node.start = function(when) { deinitialiseOscillator(); initialiseOscillator(); when = when !== undefined ? when : context.currentTime; oscillator.start(when); }; node.stop = function(when) { oscillator.stop(when); }; node.cancelScheduledEvents = function(when) { // automated params: node.frequency.cancelScheduledEvents(when); }; return node; // ~~~ function initialiseOscillator() { oscillator = context.createOscillator(); oscillator.addEventListener('ended', onEnded); oscillator.connect(node); Object.keys(properties).forEach(function(name) { oscillator[name] = properties[name]; }); oscillator.frequency.setValueAtTime(0, context.currentTime); frequencySignal.connect(oscillator.frequency); } function deinitialiseOscillator() { if(oscillator) { oscillator.removeEventListener('ended', onEnded); oscillator.disconnect(node); frequencySignal.disconnect(oscillator.frequency); oscillator = null; } } function onEnded(e) { deinitialiseOscillator(); } function makePropertyGetterSetter(property) { return { get: function() { return getProperty(property); }, set: function(v) { setProperty(property, v); }, enumerable: true }; } function getProperty(name) { return properties[name]; } function setProperty(name, value) { properties[name] = value; if(oscillator) { oscillator[name] = value; } } } // if(typeof module !== 'undefined' && module.exports) { module.exports = Oscillator; } else { this.Oscillator = Oscillator; } }).call(this); },{"openmusic-dcbias":4}],4:[function(require,module,exports){ (function() { function DCBias(context) { var output = context.createGain(); var bufferSource = context.createBufferSource(); var buffer = context.createBuffer(1, 1, context.sampleRate); buffer.getChannelData(0)[0] = 1.0; bufferSource.buffer = buffer; bufferSource.loop = true; bufferSource.connect(output); bufferSource.start(0); return output; } // if(typeof module !== 'undefined' && module.exports) { module.exports = DCBias; } else { this.DCBias = DCBias; } }).call(this); },{}],5:[function(require,module,exports){ function SamplePlayer(context) { var node = context.createGain(); var bufferSource; var bufferSourceProperties = {}; ['buffer', 'loop', 'loopStart', 'loopEnd'].forEach(function(name) { Object.defineProperty(node, name, makeBufferSourceGetterSetter(name)); }); // TODO: playbackRate which needs to be an AudioParam node.start = function(when, offset, duration) { // console.log('start', 'when', when, 'offset', offset, 'duration', duration); var buffer = bufferSourceProperties['buffer']; if(!buffer) { console.info('no buffer to play so byeee'); return; } when = when !== undefined ? when : 0; offset = offset !== undefined ? offset : 0; // TODO This is mega ugly but urgh what is going on urgh // if I just pass 'undefined' as duration Chrome doesn't play anything if(window.webkitAudioContext) { console.log('correcting for chrome aghh'); var sampleLength = buffer.length; duration = duration !== undefined ? duration : sampleLength - offset; } // Disconnect if existing, remove events listeners if(bufferSource) { bufferSource.removeEventListener('ended', onEnded); bufferSource.disconnect(node); bufferSource = null; } initialiseBufferSource(); bufferSource.start(when, offset, duration); }; node.stop = function(when) { bufferSource.stop(when); }; node.cancelScheduledEvents = function(when) { // TODO: when there is automation }; function initialiseBufferSource() { bufferSource = context.createBufferSource(); bufferSource.addEventListener('ended', onEnded); bufferSource.connect(node); Object.keys(bufferSourceProperties).forEach(function(name) { bufferSource[name] = bufferSourceProperties[name]; }); } function onEnded(e) { var t = e.target; t.disconnect(node); initialiseBufferSource(); } function makeBufferSourceGetterSetter(property) { return { get: function() { return getBufferSourceProperty(property); }, set: function(v) { setBufferSourceProperty(property, v); }, enumerable: true }; } function getBufferSourceProperty(name) { return bufferSourceProperties[name]; } function setBufferSourceProperty(name, value) { bufferSourceProperties[name] = value; if(bufferSource) { bufferSource[name] = value; } } return node; } module.exports = SamplePlayer; },{}],6:[function(require,module,exports){ function installMarkers(num){ var markerRow = document.createElement("div") markerRow.setAttribute("class", "beat-markers"); for(var i = 0; i < num; i++){ var marker = document.createElement("div"); marker.setAttribute("class", "marker") marker.setAttribute("data-index", i); markerRow.appendChild(marker); } document.body.appendChild(markerRow); var clearFix = document.createElement("div"); clearFix.setAttribute("class", "cf"); document.body.appendChild(clearFix); }; function updateMarkers(position, num){ lastPosition = position - 1; if(lastPosition < 0){ lastPosition = num - 1; } document.querySelector('.marker[data-index="'+lastPosition+'"]').classList.remove('active'); document.querySelector('.marker[data-index="'+position+'"]').classList.add('active'); } function createSaveLoadButtons(instruments){ var saveBtn = document.createElement("button"); saveBtn.textContent = "save all"; saveBtn.addEventListener("click", function(){ instruments.forEach(function(instrument){ instrument.saveRow(); }) }) document.body.appendChild(saveBtn); var loadBtn = document.createElement("button"); loadBtn.textContent = "load all"; loadBtn.addEventListener("click", function(){ instruments.forEach(function(instrument){ instrument.loadRow(); }) }) document.body.appendChild(loadBtn); } module.exports = { installMarkers: installMarkers, updateMarkers: updateMarkers, createSaveLoadButtons: createSaveLoadButtons } },{}],7:[function(require,module,exports){ var Drum = function(sampler, name){ this.sampler = sampler; this.name = name; this.probs = Array(16); this.installRow(); } Drum.prototype.play = function(pos){ if(Math.random() < this.probs[pos]){ this.sampler.start(); } } Drum.prototype.installRow = function(){ var that = this; var drum = document.createElement("div"); drum.setAttribute("class", this.name); for(var i = 0; i < this.probs.length; i++){ var cell = document.createElement("input"); cell.setAttribute("type", "text") cell.setAttribute("class", "prob") cell.setAttribute("data-index", i); cell.addEventListener("keyup", function updateProbz(e){ that.probs[~~e.target.dataset.index] = parseFloat(e.target.value); }); drum.appendChild(cell); } var label = document.createElement("span"); label.setAttribute("class", "label") label.textContent = this.name; drum.appendChild(label); var saveBtn = document.createElement("button"); saveBtn.textContent = "save"; saveBtn.addEventListener("click", function(){ that.saveRow(); }) drum.appendChild(saveBtn); var loadBtn = document.createElement("button"); loadBtn.textContent = "load"; loadBtn.addEventListener("click", function(){ that.loadRow(); }) drum.appendChild(loadBtn); document.body.appendChild(drum); } Drum.prototype.loadRow = function(){ var that = this; var noteString = localStorage.getItem(this.name); if(!noteString) return; this.probs = noteString.split(","); this.probs.forEach(function(val, i){ if(!isNaN(val)){ document.querySelector('.'+that.name+' input[data-index="'+i+'"]').value = val; } }); } Drum.prototype.saveRow = function(){ localStorage.setItem(this.name, this.probs.join(",")); } module.exports = Drum; },{}],8:[function(require,module,exports){ module.exports = function(bpm){ return (60 bundle.js gh-pages_deploy.sh index.html main.css node_modules samples 1000) / bpm; } },{}],9:[function(require,module,exports){ var SamplePlayer = require('openmusic-sample-player'); module.exports = function(ac, path){ var player = SamplePlayer(ac); var request = new XMLHttpRequest(); request.open('GET', path, true); request.responseType = 'arraybuffer'; request.onload = function() { ac.decodeAudioData(request.response, onBufferLoaded, onBufferLoadError); }; request.send(); function onBufferLoaded(buffer) { player.buffer = buffer; } function onBufferLoadError(err) { console.error('oh no', err); } return player; } },{"openmusic-sample-player":5}],10:[function(require,module,exports){ var int2freq = require("int2freq"); var Synth = function(oscillator, name){ this.oscillator = oscillator; this.name = name; this.probs = Array(16); this.notes = Array(16); this.playing = false; this.installRow(); } Synth.prototype.play = function(pos, ac){ if(Math.random() < this.probs[pos]){ var noteInt = this.notes[pos][~~(Math.random() bundle.js gh-pages_deploy.sh index.html main.css node_modules samples this.notes[pos].length)] if(!noteInt) noteInt = 0; var freq = int2freq(~~noteInt, {tonic: 'C3', scale: 'major'}); this.oscillator.frequency.setValueAtTime(freq, ac.currentTime); this.oscillator.start(); this.playing = true; } else { if(this.playing) this.oscillator.stop(ac.currentTime); this.playing = false } } Synth.prototype.installRow = function(){ var that = this; var synth = document.createElement("div"); synth.setAttribute("class", this.name); var synthProbs = document.createElement("div"); synthProbs.setAttribute("class", "synth-probs"); for(var i = 0; i < this.probs.length; i++){ var cell = document.createElement("input"); cell.setAttribute("type", "text") cell.setAttribute("class", "prob") cell.setAttribute("data-index", i); cell.addEventListener("keyup", function updateProbz(e){ that.probs[~~e.target.dataset.index] = parseFloat(e.target.value); }); synthProbs.appendChild(cell); } var clearFix = document.createElement("div"); clearFix.setAttribute("class", "cf"); synthProbs.appendChild(clearFix); for(var i = 0; i < this.probs.length; i++){ var cell = document.createElement("input"); cell.setAttribute("type", "text") cell.setAttribute("class", "notes") cell.setAttribute("data-index", i); cell.addEventListener("keyup", function updateProbz(e){ that.notes[~~e.target.dataset.index] = e.target.value.split(","); }); synthProbs.appendChild(cell); } synth.appendChild(synthProbs) var label = document.createElement("span"); label.setAttribute("class", "label") label.textContent = this.name; synth.appendChild(label); var saveBtn = document.createElement("button"); saveBtn.textContent = "save"; saveBtn.addEventListener("click", function(){ that.saveRow(); }) synth.appendChild(saveBtn); var loadBtn = document.createElement("button"); loadBtn.textContent = "load"; loadBtn.addEventListener("click", function(){ that.loadRow(); }) synth.appendChild(loadBtn); document.body.appendChild(synth); } Synth.prototype.saveRow = function(position){ localStorage.setItem(this.name+"-probs", this.probs.join(",")); localStorage.setItem(this.name+"-notes", this.notes.join("|")); } Synth.prototype.loadRow = function(position){ var that = this; var probString = localStorage.getItem(this.name+"-probs"); if(!probString) return; this.probs = probString.split(","); this.probs.forEach(function(val, i){ document.querySelector('.'+that.name+' input[data-index="'+i+'"].prob').value = val; }); var notesString = localStorage.getItem(this.name+"-notes"); if(!notesString) return; this.notes = notesString.split("|").map(function(cell){ return cell.split(","); }); this.notes.forEach(function(val, i){ document.querySelector('.'+that.name+' input[data-index="'+i+'"].notes').value = val.join(","); }); } module.exports = Synth; },{"int2freq":2}]},{},[1]) //# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyaWZ5L25vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJpbmRleC5qcyIsIm5vZGVfbW9kdWxlcy9pbnQyZnJlcS9pbmRleC5qcyIsIm5vZGVfbW9kdWxlcy9vcGVubXVzaWMtb3NjaWxsYXRvci9pbmRleC5qcyIsIm5vZGVfbW9kdWxlcy9vcGVubXVzaWMtb3NjaWxsYXRvci9ub2RlX21vZHVsZXMvb3Blbm11c2ljLWRjYmlhcy9EQ0JpYXMuanMiLCJub2RlX21vZHVsZXMvb3Blbm11c2ljLXNhbXBsZS1wbGF5ZXIvaW5kZXguanMiLCJzcmMvVUkuanMiLCJzcmMvZHJ1bS5qcyIsInNyYy9nZXRfdGljay5qcyIsInNyYy9zYW1wbGVyLmpzIiwic3JjL3N5bnRoLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBO0FDQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDdkZBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDeENBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUN4R0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUM1QkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNwR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDbkRBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNwRUE7QUFDQTtBQUNBOztBQ0ZBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3hCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwiZmlsZSI6ImdlbmVyYXRlZC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24gZSh0LG4scil7ZnVuY3Rpb24gcyhvLHUpe2lmKCFuW29dKXtpZighdFtvXSl7dmFyIGE9dHlwZW9mIHJlcXVpcmU9PVwiZnVuY3Rpb25cIiYmcmVxdWlyZTtpZighdSYmYSlyZXR1cm4gYShvLCEwKTtpZihpKXJldHVybiBpKG8sITApO3ZhciBmPW5ldyBFcnJvcihcIkNhbm5vdCBmaW5kIG1vZHVsZSAnXCIrbytcIidcIik7dGhyb3cgZi5jb2RlPVwiTU9EVUxFX05PVF9GT1VORFwiLGZ9dmFyIGw9bltvXT17ZXhwb3J0czp7fX07dFtvXVswXS5jYWxsKGwuZXhwb3J0cyxmdW5jdGlvbihlKXt2YXIgbj10W29dWzFdW2VdO3JldHVybiBzKG4/bjplKX0sbCxsLmV4cG9ydHMsZSx0LG4scil9cmV0dXJuIG5bb10uZXhwb3J0c312YXIgaT10eXBlb2YgcmVxdWlyZT09XCJmdW5jdGlvblwiJiZyZXF1aXJlO2Zvcih2YXIgbz0wO288ci5sZW5ndGg7bysrKXMocltvXSk7cmV0dXJuIHN9KSIsInZhciBOVU1fQkVBVFMgPSAxNjtcbnZhciBCUE0gPSAxMjA7XG5cbnZhciBnZXRUaWNrID0gcmVxdWlyZSgnLi9zcmMvZ2V0X3RpY2snKTtcblxudmFyIFNhbXBsZXIgPSByZXF1aXJlKCcuL3NyYy9zYW1wbGVyJyk7XG52YXIgRHJ1bSA9IHJlcXVpcmUoJy4vc3JjL2RydW0nKTtcblxudmFyIE9zY2lsbGF0b3IgPSByZXF1aXJlKCdvcGVubXVzaWMtb3NjaWxsYXRvcicpO1xudmFyIFN5bnRoID0gcmVxdWlyZSgnLi9zcmMvc3ludGgnKTtcblxudmFyIFVJID0gcmVxdWlyZSgnLi9zcmMvVUknKTtcbnZhciBpbnN0YWxsTWFya2VycyA9IFVJLmluc3RhbGxNYXJrZXJzO1xudmFyIHVwZGF0ZU1hcmtlcnMgPSBVSS51cGRhdGVNYXJrZXJzO1xudmFyIGNyZWF0ZVNhdmVMb2FkQnV0dG9ucyA9IFVJLmNyZWF0ZVNhdmVMb2FkQnV0dG9ucztcblxudmFyIGFjID0gbmV3IEF1ZGlvQ29udGV4dCgpO1xudmFyIGluc3RydW1lbnRzID0gW107XG5cbnZhciBkcnVtcyA9IFsnY2xhcCcsICdjeW0nLCAnaGF0JywgJ3NuYXJlJywgJ2tpY2snXTtcblxuZHJ1bXMuZm9yRWFjaChmdW5jdGlvbihkcnVtKXtcbiAgdmFyIHNhbXBsZXIgPSBuZXcgU2FtcGxlcihhYywgJ3NhbXBsZXMvJytkcnVtKycud2F2Jyk7XG4gIHNhbXBsZXIuY29ubmVjdChhYy5kZXN0aW5hdGlvbik7XG4gIHZhciBkcnVtID0gbmV3IERydW0oc2FtcGxlciwgZHJ1bSk7XG4gIGluc3RydW1lbnRzLnB1c2goZHJ1bSlcbn0pXG5cbnZhciBzeW50aHMgPSBbJ3RyaWFuZ2xlJywgJ3NpbmUnXTtcblxuc3ludGhzLmZvckVhY2goZnVuY3Rpb24oc3ludGgpe1xuICB2YXIgb3NjaWxsYXRvciA9IG5ldyBPc2NpbGxhdG9yKGFjKTtcbiAgb3NjaWxsYXRvci50eXBlID0gc3ludGg7XG4gIG9zY2lsbGF0b3IuY29ubmVjdChhYy5kZXN0aW5hdGlvbik7XG4gIHZhciBzeW50aGVzaXplciA9IG5ldyBTeW50aChvc2NpbGxhdG9yLCBzeW50aCk7XG4gIGluc3RydW1lbnRzLnB1c2goc3ludGhlc2l6ZXIpO1xufSlcblxudmFyIHBvc2l0aW9uID0gMDtcblxudmFyIGludGVydmFsO1xuXG52YXIgdGljayA9IGdldFRpY2soQlBNKTtcblxuXG5cblxuZnVuY3Rpb24gcnVuKHRpY2spe1xuICBpbnRlcnZhbCA9IHdpbmRvdy5zZXRJbnRlcnZhbChmdW5jdGlvbigpe1xuICAgIHVwZGF0ZU1hcmtlcnMocG9zaXRpb24sIE5VTV9CRUFUUyk7XG4gICAgaW5zdHJ1bWVudHMuZm9yRWFjaChmdW5jdGlvbihpbnN0cnVtZW50KXtcbiAgICAgIGluc3RydW1lbnQucGxheShwb3NpdGlvbiwgYWMpO1xuICAgIH0pXG4gICAgcG9zaXRpb24rKztcbiAgICBpZihwb3NpdGlvbiA+PSAxNil7XG4gICAgICBwb3NpdGlvbiA9IDA7XG4gICAgfVxuICB9LCB0aWNrKTtcbn07XG5cblxuZnVuY3Rpb24gY3JlYXRlU2xpZGVyKHJ1bil7XG4gIHZhciBzbGlkZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuICBzbGlkZXIuc2V0QXR0cmlidXRlKFwiY2xhc3NcIiwgXCJicG0tc2xpZGVyXCIpO1xuICB2YXIgYnBtSW5mbyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJzcGFuXCIpO1xuICBicG1JbmZvLnNldEF0dHJpYnV0ZShcImNsYXNzXCIsIFwiYnBtLWluZm9cIik7XG4gIGJwbUluZm8udGV4dENvbnRlbnQgPSBCUE0rJ2JwbSc7XG4gIHZhciBicG1TbGlkZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiaW5wdXRcIik7XG4gIGJwbVNsaWRlci5zZXRBdHRyaWJ1dGUoXCJ0eXBlXCIsIFwicmFuZ2VcIik7XG4gIGJwbVNsaWRlci5zZXRBdHRyaWJ1dGUoXCJtaW5cIiwgMjApO1xuICBicG1TbGlkZXIuc2V0QXR0cmlidXRlKFwibWF4XCIsIDUwMCk7XG4gIGJwbVNsaWRlci5vbmlucHV0ID0gZnVuY3Rpb24gdXBkYXRlQlBNKGUpe1xuICAgIHdpbmRvdy5jbGVhckludGVydmFsKGludGVydmFsKTtcbiAgICBicG0gPSBlLnRhcmdldC52YWx1ZUFzTnVtYmVyO1xuICAgIGJwbUluZm8udGV4dENvbnRlbnQgPSBicG0gKyAnYnBtJztcbiAgICB0aWNrID0gZ2V0VGljayhicG0pO1xuICAgIHJ1bih0aWNrKTtcbiAgfTtcbiAgc2xpZGVyLmFwcGVuZENoaWxkKGJwbVNsaWRlcik7XG4gIHNsaWRlci5hcHBlbmRDaGlsZChicG1JbmZvKTtcbiAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChzbGlkZXIpO1xufVxuXG5pbnN0YWxsTWFya2VycyhOVU1fQkVBVFMpO1xuY3JlYXRlU2xpZGVyKHJ1bik7XG5jcmVhdGVTYXZlTG9hZEJ1dHRvbnMoaW5zdHJ1bWVudHMpO1xucnVuKHRpY2spO1xuIiwibW9kdWxlLmV4cG9ydHMgPSBpbnQyZnJlcVxuXG52YXIgc2NhbGVzID0ge1xuICBtYWpvcjogWzIsIDIsIDEsIDIsIDIsIDIsIDFdLFxuICBtaW5vcjogWzIsIDEsIDIsIDIsIDEsIDIsIDJdLFxuICBwZW50TWFqOiBbMiwgMiwgMywgMiwgM10sXG4gIHBlbnRNaW46IFszLCAyLCAyLCAzLCAyXVxufVxuXG52YXIgbm90ZXMgPSBbXG4gICdBMCcsICdBIzAnLCAnQjAnLCAnQzEnLCAnQyMxJywgJ0QxJywgJ0QjMScsICdFMScsICdGMScsICdGIzEnLCAnRzEnLCAnRyMxJyxcbiAgJ0ExJywgJ0EjMScsICdCMScsICdDMicsICdDIzInLCAnRDInLCAnRCMyJywgJ0UyJywgJ0YyJywgJ0YjMicsICdHMicsICdHIzInLFxuICAnQTInLCAnQSMyJywgJ0IyJywgJ0MzJywgJ0MjMycsICdEMycsICdEIzMnLCAnRTMnLCAnRjMnLCAnRiMzJywgJ0czJywgJ0cjMycsXG4gICdBMycsICdBIzMnLCAnQjMnLCAnQzQnLCAnQyM0JywgJ0Q0JywgJ0QjNCcsICdFNCcsICdGNCcsICdGIzQnLCAnRzQnLCAnRyM0JyxcbiAgJ0E0JywgJ0EjNCcsICdCNCcsICdDNScsICdDIzUnLCAnRDUnLCAnRCM1JywgJ0U1JywgJ0Y1JywgJ0YjNScsICdHNScsICdHIzUnLFxuICAnQTUnLCAnQSM1JywgJ0I1JywgJ0M2JywgJ0MjNicsICdENicsICdEIzYnLCAnRTYnLCAnRjYnLCAnRiM2JywgJ0c2JywgJ0cjNicsXG4gICdBNicsICdBIzYnLCAnQjYnLCAnQzcnLCAnQyM3JywgJ0Q3JywgJ0QjNycsICdFNycsICdGNycsICdGIzcnLCAnRzcnLCAnRyM3JyxcbiAgJ0E3JywgJ0EjNycsICdCNycsICdDOCdcbl1cblxudmFyIHN0cjJmcmVxID0ge1xuICAnQTAnOiAyNy41MDAwLCAnQSMwJzogMjkuMTM1MiwgJ0IwJzogMzAuODY3NywgJ0MxJzogMzIuNzAzMiwgJ0MjMSc6IDM0LjY0NzgsICdEMSc6IDM2LjcwODEsICdEIzEnOiAzOC44OTA5LCAnRTEnOiA0MS4yMDM0LCAnRjEnOiA0My42NTM1LCAnRiMxJzogNDYuMjQ5MywgJ0cxJzogNDguOTk5NCwgJ0cjMSc6IDUxLjkxMzEsXG4gICdBMSc6IDU1LjAwMDAsICdBIzEnOiA1OC4yNzA1LCAnQjEnOiA2MS43MzU0LCAnQzInOiA2NS40MDY0LCAnQyMyJzogNjkuMjk1NywgJ0QyJzogNzMuNDE2MiwgJ0QjMic6IDc3Ljc4MTcsICdFMic6IDgyLjQwNjksICdGMic6IDg3LjMwNzEsICdGIzInOiA5Mi40OTg2LCAnRzInOiA5Ny45OTg5LCAnRyMyJzogMTAzLjgyNixcbiAgJ0EyJzogMTEwLjAwMCwgJ0EjMic6IDExNi41NDEsICdCMic6IDEyMy40NzEsICdDMyc6IDEzMC44MTMsICdDIzMnOiAxMzguNTkxLCAnRDMnOiAxNDYuODMyLCAnRCMzJzogMTU1LjU2MywgJ0UzJzogMTY0LjgxNCwgJ0YzJzogMTc0LjYxNCwgJ0YjMyc6IDE4NC45OTcsICdHMyc6IDE5NS45OTgsICdHIzMnOiAyMDcuNjUyLFxuICAnQTMnOiAyMjAuMDAwLCAnQSMzJzogMjMzLjA4MiwgJ0IzJzogMjQ2Ljk0MiwgJ0M0JzogMjYxLjYyNiwgJ0MjNCc6IDI3Ny4xODMsICdENCc6IDI5My42NjUsICdEIzQnOiAzMTEuMTI3LCAnRTQnOiAzMjkuNjI4LCAnRjQnOiAzNDkuMjI4LCAnRiM0JzogMzY5Ljk5NCwgJ0c0JzogMzkxLjk5NSwgJ0cjNCc6IDQxNS4zMDUsXG4gICdBNCc6IDQ0MC4wMDAsICdBIzQnOiA0NjYuMTY0LCAnQjQnOiA0OTMuODgzLCAnQzUnOiA1MjMuMjUxLCAnQyM1JzogNTU0LjM2NSwgJ0Q1JzogNTg3LjMzMCwgJ0QjNSc6IDYyMi4yNTQsICdFNSc6IDY1OS4yNTUsICdGNSc6IDY5OC40NTYsICdGIzUnOiA3MzkuOTg5LCAnRzUnOiA3ODMuOTkxLCAnRyM1JzogODMwLjYwOSxcbiAgJ0E1JzogODgwLjAwMCwgJ0EjNSc6IDkzMi4zMjgsICdCNSc6IDk4Ny43NjcsICdDNic6IDEwNDYuNTAsICdDIzYnOiAxMTA4LjczLCAnRDYnOiAxMTc0LjY2LCAnRCM2JzogMTI0NC41MSwgJ0U2JzogMTMxOC41MSwgJ0Y2JzogMTM5Ni45MSwgJ0YjNic6IDE0NzkuOTgsICdHNic6IDE1NjcuOTgsICdHIzYnOiAxNjYxLjIyLFxuICAnQTYnOiAxNzYwLjAwLCAnQSM2JzogMTg2NC42NiwgJ0I2JzogMTk3NS41MywgJ0M3JzogMjA5My4wMCwgJ0MjNyc6IDIyMTcuNDYsICdENyc6IDIzNDkuMzIsICdEIzcnOiAyNDg5LjAyLCAnRTcnOiAyNjM3LjAyLCAnRjcnOiAyNzkzLjgzLCAnRiM3JzogMjk1OS45NiwgJ0c3JzogMzEzNS45NiwgJ0cjNyc6IDMzMjIuNDQsXG4gICdBNyc6IDM1MjAuMDAsICdBIzcnOiAzNzI5LjMxLCAnQjcnOiAzOTUxLjA3LCAnQzgnOiA0MTg2LjAxXG59XG5cblxuZnVuY3Rpb24gaW50MmZyZXEoaW50Tm90ZSwgb3B0aW9ucyl7XG4gIHZhciBpbmRleCwgc2NhbGU7XG4gIGlmKChpbmRleCA9IG5vdGVzLmluZGV4T2Yob3B0aW9ucy50b25pYykpID09PSAtMSkgdGhyb3cgJ3doYXQgaXMgdXAgd2l0aCB0aGF0IHRvbmljPydcbiAgaWYoIShzY2FsZSA9IHNjYWxlc1tvcHRpb25zLnNjYWxlXSkpIHRocm93ICd3aGF0IGlzIHVwIHdpdGggdGhhdCBzY2FsZT8nXG4gIHdoaWxlIChNYXRoLmFicyhpbnROb3RlKSA+IHNjYWxlLmxlbmd0aCkgc2NhbGUgPSBzY2FsZS5jb25jYXQoc2NhbGUpXG4gIGlmKGludE5vdGUgPj0gMCkgZm9yICh2YXIgaSA9IDA7IGkgPCBpbnROb3RlOyBpbmRleCArPSBzY2FsZVtpXSwgaSs9IDEgKXt9XG4gIGVsc2UgZm9yICh2YXIgaiA9IC0xOyBqID49IGludE5vdGU7IGluZGV4IC09IHNjYWxlW3NjYWxlLmxlbmd0aCArIGpdLCBqLT0gMSl7fVxuICByZXR1cm4gc3RyMmZyZXFbbm90ZXNbaW5kZXhdXVxufSIsIihmdW5jdGlvbigpIHtcblxuXHR2YXIgRENCaWFzID0gcmVxdWlyZSgnb3Blbm11c2ljLWRjYmlhcycpO1xuXG5cdGZ1bmN0aW9uIE9zY2lsbGF0b3IoY29udGV4dCkge1xuXHRcdFxuXHRcdHZhciBub2RlID0gY29udGV4dC5jcmVhdGVHYWluKCk7XG5cdFx0dmFyIG9zY2lsbGF0b3I7XG5cdFx0dmFyIGZyZXF1ZW5jeVNpZ25hbDtcblx0XHR2YXIgcHJvcGVydGllcyA9IHt9O1xuXG5cdFx0ZnJlcXVlbmN5U2lnbmFsID0gRENCaWFzKGNvbnRleHQpO1xuXHRcdG5vZGUuZnJlcXVlbmN5ID0gZnJlcXVlbmN5U2lnbmFsLmdhaW47XG5cdFx0bm9kZS5mcmVxdWVuY3kuc2V0VmFsdWVBdFRpbWUoNDQwLCBjb250ZXh0LmN1cnJlbnRUaW1lKTtcblxuXHRcdFsndHlwZSddLmZvckVhY2goZnVuY3Rpb24obmFtZSkge1xuXHRcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KG5vZGUsIG5hbWUsIG1ha2VQcm9wZXJ0eUdldHRlclNldHRlcihuYW1lKSk7XG5cdFx0fSk7XG5cblx0XHRub2RlLnN0YXJ0ID0gZnVuY3Rpb24od2hlbikge1xuXG5cdFx0XHRkZWluaXRpYWxpc2VPc2NpbGxhdG9yKCk7XG5cblx0XHRcdGluaXRpYWxpc2VPc2NpbGxhdG9yKCk7XG5cblx0XHRcdHdoZW4gPSB3aGVuICE9PSB1bmRlZmluZWQgPyB3aGVuIDogY29udGV4dC5jdXJyZW50VGltZTtcblxuXHRcdFx0b3NjaWxsYXRvci5zdGFydCh3aGVuKTtcblx0XHR9O1xuXG5cdFx0bm9kZS5zdG9wID0gZnVuY3Rpb24od2hlbikge1xuXHRcdFx0b3NjaWxsYXRvci5zdG9wKHdoZW4pO1xuXHRcdH07XG5cblx0XHRub2RlLmNhbmNlbFNjaGVkdWxlZEV2ZW50cyA9IGZ1bmN0aW9uKHdoZW4pIHtcblx0XHRcdC8vIGF1dG9tYXRlZCBwYXJhbXM6XG5cdFx0XHRub2RlLmZyZXF1ZW5jeS5jYW5jZWxTY2hlZHVsZWRFdmVudHMod2hlbik7XG5cdFx0fTtcblxuXHRcdHJldHVybiBub2RlO1xuXG5cdFx0Ly8gfn5+XG5cblx0XHRmdW5jdGlvbiBpbml0aWFsaXNlT3NjaWxsYXRvcigpIHtcblx0XHRcdG9zY2lsbGF0b3IgPSBjb250ZXh0LmNyZWF0ZU9zY2lsbGF0b3IoKTtcblx0XHRcdG9zY2lsbGF0b3IuYWRkRXZlbnRMaXN0ZW5lcignZW5kZWQnLCBvbkVuZGVkKTtcblx0XHRcdG9zY2lsbGF0b3IuY29ubmVjdChub2RlKTtcblxuXHRcdFx0T2JqZWN0LmtleXMocHJvcGVydGllcykuZm9yRWFjaChmdW5jdGlvbihuYW1lKSB7XG5cdFx0XHRcdG9zY2lsbGF0b3JbbmFtZV0gPSBwcm9wZXJ0aWVzW25hbWVdO1xuXHRcdFx0fSk7XG5cblx0XHRcdG9zY2lsbGF0b3IuZnJlcXVlbmN5LnNldFZhbHVlQXRUaW1lKDAsIGNvbnRleHQuY3VycmVudFRpbWUpO1xuXHRcdFx0ZnJlcXVlbmN5U2lnbmFsLmNvbm5lY3Qob3NjaWxsYXRvci5mcmVxdWVuY3kpO1xuXHRcdH1cblxuXHRcdGZ1bmN0aW9uIGRlaW5pdGlhbGlzZU9zY2lsbGF0b3IoKSB7XG5cdFx0XHRpZihvc2NpbGxhdG9yKSB7XG5cdFx0XHRcdG9zY2lsbGF0b3IucmVtb3ZlRXZlbnRMaXN0ZW5lcignZW5kZWQnLCBvbkVuZGVkKTtcblx0XHRcdFx0b3NjaWxsYXRvci5kaXNjb25uZWN0KG5vZGUpO1xuXHRcdFx0XHRmcmVxdWVuY3lTaWduYWwuZGlzY29ubmVjdChvc2NpbGxhdG9yLmZyZXF1ZW5jeSk7XG5cdFx0XHRcdG9zY2lsbGF0b3IgPSBudWxsO1xuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGZ1bmN0aW9uIG9uRW5kZWQoZSkge1xuXHRcdFx0ZGVpbml0aWFsaXNlT3NjaWxsYXRvcigpO1xuXHRcdH1cblxuXHRcdGZ1bmN0aW9uIG1ha2VQcm9wZXJ0eUdldHRlclNldHRlcihwcm9wZXJ0eSkge1xuXHRcdFx0cmV0dXJuIHtcblx0XHRcdFx0Z2V0OiBmdW5jdGlvbigpIHtcblx0XHRcdFx0XHRyZXR1cm4gZ2V0UHJvcGVydHkocHJvcGVydHkpO1xuXHRcdFx0XHR9LFxuXHRcdFx0XHRzZXQ6IGZ1bmN0aW9uKHYpIHtcblx0XHRcdFx0XHRzZXRQcm9wZXJ0eShwcm9wZXJ0eSwgdik7XG5cdFx0XHRcdH0sXG5cdFx0XHRcdGVudW1lcmFibGU6IHRydWVcblx0XHRcdH07XG5cdFx0fVxuXG5cdFx0ZnVuY3Rpb24gZ2V0UHJvcGVydHkobmFtZSkge1xuXHRcdFx0cmV0dXJuIHByb3BlcnRpZXNbbmFtZV07XG5cdFx0fVxuXG5cdFx0ZnVuY3Rpb24gc2V0UHJvcGVydHkobmFtZSwgdmFsdWUpIHtcblx0XHRcdHByb3BlcnRpZXNbbmFtZV0gPSB2YWx1ZTtcblx0XHRcdGlmKG9zY2lsbGF0b3IpIHtcblx0XHRcdFx0b3NjaWxsYXRvcltuYW1lXSA9IHZhbHVlO1xuXHRcdFx0fVxuXHRcdH1cblxuXHR9XG5cblx0Ly9cblx0XG5cdGlmKHR5cGVvZiBtb2R1bGUgIT09ICd1bmRlZmluZWQnICYmIG1vZHVsZS5leHBvcnRzKSB7XG5cdFx0bW9kdWxlLmV4cG9ydHMgPSBPc2NpbGxhdG9yO1xuXHR9IGVsc2Uge1xuXHRcdHRoaXMuT3NjaWxsYXRvciA9IE9zY2lsbGF0b3I7XG5cdH1cblxufSkuY2FsbCh0aGlzKTtcblxuIiwiKGZ1bmN0aW9uKCkge1xuXHRcblx0ZnVuY3Rpb24gRENCaWFzKGNvbnRleHQpIHtcblx0XHRcblx0XHR2YXIgb3V0cHV0ID0gY29udGV4dC5jcmVhdGVHYWluKCk7XG5cdFx0dmFyIGJ1ZmZlclNvdXJjZSA9IGNvbnRleHQuY3JlYXRlQnVmZmVyU291cmNlKCk7XG5cdFx0dmFyIGJ1ZmZlciA9IGNvbnRleHQuY3JlYXRlQnVmZmVyKDEsIDEsIGNvbnRleHQuc2FtcGxlUmF0ZSk7XG5cblx0XHRidWZmZXIuZ2V0Q2hhbm5lbERhdGEoMClbMF0gPSAxLjA7XG5cdFx0YnVmZmVyU291cmNlLmJ1ZmZlciA9IGJ1ZmZlcjtcblx0XHRidWZmZXJTb3VyY2UubG9vcCA9IHRydWU7XG5cdFx0XG5cdFx0YnVmZmVyU291cmNlLmNvbm5lY3Qob3V0cHV0KTtcblx0XHRidWZmZXJTb3VyY2Uuc3RhcnQoMCk7XG5cdFx0XG5cdFx0cmV0dXJuIG91dHB1dDtcblx0XHRcblx0fVxuXG5cdC8vXG5cdFxuXHRpZih0eXBlb2YgbW9kdWxlICE9PSAndW5kZWZpbmVkJyAmJiBtb2R1bGUuZXhwb3J0cykge1xuXHRcdG1vZHVsZS5leHBvcnRzID0gRENCaWFzO1xuXHR9IGVsc2Uge1xuXHRcdHRoaXMuRENCaWFzID0gRENCaWFzO1xuXHR9XG5cbn0pLmNhbGwodGhpcyk7XG4iLCJmdW5jdGlvbiBTYW1wbGVQbGF5ZXIoY29udGV4dCkge1xuXHR2YXIgbm9kZSA9IGNvbnRleHQuY3JlYXRlR2FpbigpO1xuXHR2YXIgYnVmZmVyU291cmNlO1xuXHR2YXIgYnVmZmVyU291cmNlUHJvcGVydGllcyA9IHt9O1xuXG5cdFsnYnVmZmVyJywgJ2xvb3AnLCAnbG9vcFN0YXJ0JywgJ2xvb3BFbmQnXS5mb3JFYWNoKGZ1bmN0aW9uKG5hbWUpIHtcblx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkobm9kZSwgbmFtZSwgbWFrZUJ1ZmZlclNvdXJjZUdldHRlclNldHRlcihuYW1lKSk7XG5cdH0pO1xuXG5cdC8vIFRPRE86IHBsYXliYWNrUmF0ZSB3aGljaCBuZWVkcyB0byBiZSBhbiBBdWRpb1BhcmFtXG5cblx0bm9kZS5zdGFydCA9IGZ1bmN0aW9uKHdoZW4sIG9mZnNldCwgZHVyYXRpb24pIHtcblx0XHQvLyBjb25zb2xlLmxvZygnc3RhcnQnLCAnd2hlbicsIHdoZW4sICdvZmZzZXQnLCBvZmZzZXQsICdkdXJhdGlvbicsIGR1cmF0aW9uKTtcblxuXHRcdHZhciBidWZmZXIgPSBidWZmZXJTb3VyY2VQcm9wZXJ0aWVzWydidWZmZXInXTtcblx0XHRpZighYnVmZmVyKSB7XG5cdFx0XHRjb25zb2xlLmluZm8oJ25vIGJ1ZmZlciB0byBwbGF5IHNvIGJ5ZWVlJyk7XG5cdFx0XHRyZXR1cm47XG5cdFx0fVxuXG5cdFx0d2hlbiA9IHdoZW4gIT09IHVuZGVmaW5lZCA/IHdoZW4gOiAwO1xuXHRcdG9mZnNldCA9IG9mZnNldCAhPT0gdW5kZWZpbmVkID8gb2Zmc2V0IDogMDtcblx0XHRcblx0XHQvLyBUT0RPIFRoaXMgaXMgbWVnYSB1Z2x5IGJ1dCB1cmdoIHdoYXQgaXMgZ29pbmcgb24gdXJnaFxuXHRcdC8vIGlmIEkganVzdCBwYXNzICd1bmRlZmluZWQnIGFzIGR1cmF0aW9uIENocm9tZSBkb2Vzbid0IHBsYXkgYW55dGhpbmdcblx0XHRpZih3aW5kb3cud2Via2l0QXVkaW9Db250ZXh0KSB7XG5cdFx0XHRjb25zb2xlLmxvZygnY29ycmVjdGluZyBmb3IgY2hyb21lIGFnaGgnKTtcblx0XHRcdHZhciBzYW1wbGVMZW5ndGggPSBidWZmZXIubGVuZ3RoO1xuXHRcdFx0ZHVyYXRpb24gPSBkdXJhdGlvbiAhPT0gdW5kZWZpbmVkID8gZHVyYXRpb24gOiBzYW1wbGVMZW5ndGggLSBvZmZzZXQ7XG5cdFx0fVxuXG5cdFx0Ly8gRGlzY29ubmVjdCBpZiBleGlzdGluZywgcmVtb3ZlIGV2ZW50cyBsaXN0ZW5lcnNcblx0XHRpZihidWZmZXJTb3VyY2UpIHtcblx0XHRcdGJ1ZmZlclNvdXJjZS5yZW1vdmVFdmVudExpc3RlbmVyKCdlbmRlZCcsIG9uRW5kZWQpO1xuXHRcdFx0YnVmZmVyU291cmNlLmRpc2Nvbm5lY3Qobm9kZSk7XG5cdFx0XHRidWZmZXJTb3VyY2UgPSBudWxsO1xuXHRcdH1cblxuXHRcdGluaXRpYWxpc2VCdWZmZXJTb3VyY2UoKTtcblxuXHRcdGJ1ZmZlclNvdXJjZS5zdGFydCh3aGVuLCBvZmZzZXQsIGR1cmF0aW9uKTtcblxuXHR9O1xuXG5cdG5vZGUuc3RvcCA9IGZ1bmN0aW9uKHdoZW4pIHtcblx0XHRidWZmZXJTb3VyY2Uuc3RvcCh3aGVuKTtcblx0fTtcblxuXHRub2RlLmNhbmNlbFNjaGVkdWxlZEV2ZW50cyA9IGZ1bmN0aW9uKHdoZW4pIHtcblx0XHQvLyBUT0RPOiB3aGVuIHRoZXJlIGlzIGF1dG9tYXRpb25cblx0fTtcblxuXHRmdW5jdGlvbiBpbml0aWFsaXNlQnVmZmVyU291cmNlKCkge1xuXHRcdFxuXHRcdGJ1ZmZlclNvdXJjZSA9IGNvbnRleHQuY3JlYXRlQnVmZmVyU291cmNlKCk7XG5cdFx0YnVmZmVyU291cmNlLmFkZEV2ZW50TGlzdGVuZXIoJ2VuZGVkJywgb25FbmRlZCk7XG5cdFx0YnVmZmVyU291cmNlLmNvbm5lY3Qobm9kZSk7XG5cblx0XHRPYmplY3Qua2V5cyhidWZmZXJTb3VyY2VQcm9wZXJ0aWVzKS5mb3JFYWNoKGZ1bmN0aW9uKG5hbWUpIHtcblx0XHRcdGJ1ZmZlclNvdXJjZVtuYW1lXSA9IGJ1ZmZlclNvdXJjZVByb3BlcnRpZXNbbmFtZV07XG5cdFx0fSk7XG5cblx0fVxuXG5cdGZ1bmN0aW9uIG9uRW5kZWQoZSkge1xuXHRcdHZhciB0ID0gZS50YXJnZXQ7XG5cdFx0dC5kaXNjb25uZWN0KG5vZGUpO1xuXHRcdGluaXRpYWxpc2VCdWZmZXJTb3VyY2UoKTtcblx0fVxuXG5cdGZ1bmN0aW9uIG1ha2VCdWZmZXJTb3VyY2VHZXR0ZXJTZXR0ZXIocHJvcGVydHkpIHtcblx0XHRyZXR1cm4ge1xuXHRcdFx0Z2V0OiBmdW5jdGlvbigpIHtcblx0XHRcdFx0cmV0dXJuIGdldEJ1ZmZlclNvdXJjZVByb3BlcnR5KHByb3BlcnR5KTtcblx0XHRcdH0sXG5cdFx0XHRzZXQ6IGZ1bmN0aW9uKHYpIHtcblx0XHRcdFx0c2V0QnVmZmVyU291cmNlUHJvcGVydHkocHJvcGVydHksIHYpO1xuXHRcdFx0fSxcblx0XHRcdGVudW1lcmFibGU6IHRydWVcblx0XHR9O1xuXHR9XG5cblx0ZnVuY3Rpb24gZ2V0QnVmZmVyU291cmNlUHJvcGVydHkobmFtZSkge1xuXHRcdHJldHVybiBidWZmZXJTb3VyY2VQcm9wZXJ0aWVzW25hbWVdO1xuXHR9XG5cblx0ZnVuY3Rpb24gc2V0QnVmZmVyU291cmNlUHJvcGVydHkobmFtZSwgdmFsdWUpIHtcblxuXHRcdGJ1ZmZlclNvdXJjZVByb3BlcnRpZXNbbmFtZV0gPSB2YWx1ZTtcblxuXHRcdGlmKGJ1ZmZlclNvdXJjZSkge1xuXHRcdFx0YnVmZmVyU291cmNlW25hbWVdID0gdmFsdWU7XG5cdFx0fVxuXG5cdH1cblxuXHRyZXR1cm4gbm9kZTtcbn1cblxubW9kdWxlLmV4cG9ydHMgPSBTYW1wbGVQbGF5ZXI7XG4iLCJmdW5jdGlvbiBpbnN0YWxsTWFya2VycyhudW0pe1xuICB2YXIgbWFya2VyUm93ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKVxuICBtYXJrZXJSb3cuc2V0QXR0cmlidXRlKFwiY2xhc3NcIiwgXCJiZWF0LW1hcmtlcnNcIik7XG5cbiAgZm9yKHZhciBpID0gMDsgaSA8IG51bTsgaSsrKXtcbiAgICB2YXIgbWFya2VyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcbiAgICBtYXJrZXIuc2V0QXR0cmlidXRlKFwiY2xhc3NcIiwgXCJtYXJrZXJcIilcbiAgICBtYXJrZXIuc2V0QXR0cmlidXRlKFwiZGF0YS1pbmRleFwiLCBpKTtcbiAgICBtYXJrZXJSb3cuYXBwZW5kQ2hpbGQobWFya2VyKTtcbiAgfVxuXG4gIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQobWFya2VyUm93KTtcbiAgdmFyIGNsZWFyRml4ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcbiAgY2xlYXJGaXguc2V0QXR0cmlidXRlKFwiY2xhc3NcIiwgXCJjZlwiKTtcbiAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChjbGVhckZpeCk7XG59O1xuXG5mdW5jdGlvbiB1cGRhdGVNYXJrZXJzKHBvc2l0aW9uLCBudW0pe1xuICBsYXN0UG9zaXRpb24gPSBwb3NpdGlvbiAtIDE7XG4gIGlmKGxhc3RQb3NpdGlvbiA8IDApe1xuICAgIGxhc3RQb3NpdGlvbiA9IG51bSAtIDE7XG4gIH1cbiAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLm1hcmtlcltkYXRhLWluZGV4PVwiJytsYXN0UG9zaXRpb24rJ1wiXScpLmNsYXNzTGlzdC5yZW1vdmUoJ2FjdGl2ZScpO1xuXG4gIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5tYXJrZXJbZGF0YS1pbmRleD1cIicrcG9zaXRpb24rJ1wiXScpLmNsYXNzTGlzdC5hZGQoJ2FjdGl2ZScpO1xufVxuXG5mdW5jdGlvbiBjcmVhdGVTYXZlTG9hZEJ1dHRvbnMoaW5zdHJ1bWVudHMpe1xuICB2YXIgc2F2ZUJ0biA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJidXR0b25cIik7XG4gIHNhdmVCdG4udGV4dENvbnRlbnQgPSBcInNhdmUgYWxsXCI7XG4gIHNhdmVCdG4uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGZ1bmN0aW9uKCl7XG4gICAgaW5zdHJ1bWVudHMuZm9yRWFjaChmdW5jdGlvbihpbnN0cnVtZW50KXtcbiAgICAgIGluc3RydW1lbnQuc2F2ZVJvdygpO1xuICAgIH0pXG4gIH0pXG4gIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQoc2F2ZUJ0bik7XG5cbiAgdmFyIGxvYWRCdG4gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiYnV0dG9uXCIpO1xuICBsb2FkQnRuLnRleHRDb250ZW50ID0gXCJsb2FkIGFsbFwiO1xuICBsb2FkQnRuLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBmdW5jdGlvbigpe1xuICAgIGluc3RydW1lbnRzLmZvckVhY2goZnVuY3Rpb24oaW5zdHJ1bWVudCl7XG4gICAgICBpbnN0cnVtZW50LmxvYWRSb3coKTtcbiAgICB9KVxuICB9KVxuICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKGxvYWRCdG4pO1xufVxuXG5tb2R1bGUuZXhwb3J0cyA9IHtcbiAgaW5zdGFsbE1hcmtlcnM6IGluc3RhbGxNYXJrZXJzLFxuICB1cGRhdGVNYXJrZXJzOiB1cGRhdGVNYXJrZXJzLFxuICBjcmVhdGVTYXZlTG9hZEJ1dHRvbnM6IGNyZWF0ZVNhdmVMb2FkQnV0dG9uc1xufSIsInZhciBEcnVtID0gZnVuY3Rpb24oc2FtcGxlciwgbmFtZSl7XG4gIHRoaXMuc2FtcGxlciA9IHNhbXBsZXI7XG4gIHRoaXMubmFtZSA9IG5hbWU7XG4gIHRoaXMucHJvYnMgPSBBcnJheSgxNik7XG4gIHRoaXMuaW5zdGFsbFJvdygpO1xufVxuXG5EcnVtLnByb3RvdHlwZS5wbGF5ID0gZnVuY3Rpb24ocG9zKXtcbiAgaWYoTWF0aC5yYW5kb20oKSA8IHRoaXMucHJvYnNbcG9zXSl7XG4gICAgdGhpcy5zYW1wbGVyLnN0YXJ0KCk7XG4gIH1cbn1cblxuRHJ1bS5wcm90b3R5cGUuaW5zdGFsbFJvdyA9IGZ1bmN0aW9uKCl7XG4gIHZhciB0aGF0ID0gdGhpcztcblxuICB2YXIgZHJ1bSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG4gIGRydW0uc2V0QXR0cmlidXRlKFwiY2xhc3NcIiwgdGhpcy5uYW1lKTtcblxuICBmb3IodmFyIGkgPSAwOyBpIDwgdGhpcy5wcm9icy5sZW5ndGg7IGkrKyl7XG4gICAgdmFyIGNlbGwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiaW5wdXRcIik7XG4gICAgY2VsbC5zZXRBdHRyaWJ1dGUoXCJ0eXBlXCIsIFwidGV4dFwiKVxuICAgIGNlbGwuc2V0QXR0cmlidXRlKFwiY2xhc3NcIiwgXCJwcm9iXCIpXG4gICAgY2VsbC5zZXRBdHRyaWJ1dGUoXCJkYXRhLWluZGV4XCIsIGkpO1xuICAgIGNlbGwuYWRkRXZlbnRMaXN0ZW5lcihcImtleXVwXCIsIGZ1bmN0aW9uIHVwZGF0ZVByb2J6KGUpe1xuICAgICAgdGhhdC5wcm9ic1t+fmUudGFyZ2V0LmRhdGFzZXQuaW5kZXhdID0gcGFyc2VGbG9hdChlLnRhcmdldC52YWx1ZSk7XG4gICAgfSk7XG4gICAgZHJ1bS5hcHBlbmRDaGlsZChjZWxsKTtcbiAgfVxuXG4gIHZhciBsYWJlbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJzcGFuXCIpO1xuICBsYWJlbC5zZXRBdHRyaWJ1dGUoXCJjbGFzc1wiLCBcImxhYmVsXCIpXG4gIGxhYmVsLnRleHRDb250ZW50ID0gdGhpcy5uYW1lO1xuICBkcnVtLmFwcGVuZENoaWxkKGxhYmVsKTtcblxuICB2YXIgc2F2ZUJ0biA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJidXR0b25cIik7XG4gIHNhdmVCdG4udGV4dENvbnRlbnQgPSBcInNhdmVcIjtcbiAgc2F2ZUJ0bi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgZnVuY3Rpb24oKXtcbiAgICB0aGF0LnNhdmVSb3coKTtcbiAgfSlcbiAgZHJ1bS5hcHBlbmRDaGlsZChzYXZlQnRuKTtcblxuICB2YXIgbG9hZEJ0biA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJidXR0b25cIik7XG4gIGxvYWRCdG4udGV4dENvbnRlbnQgPSBcImxvYWRcIjtcbiAgbG9hZEJ0bi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgZnVuY3Rpb24oKXtcbiAgICB0aGF0LmxvYWRSb3coKTtcbiAgfSlcbiAgZHJ1bS5hcHBlbmRDaGlsZChsb2FkQnRuKTtcblxuICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKGRydW0pO1xufVxuXG5EcnVtLnByb3RvdHlwZS5sb2FkUm93ID0gZnVuY3Rpb24oKXtcbiAgdmFyIHRoYXQgPSB0aGlzO1xuICB2YXIgbm90ZVN0cmluZyA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKHRoaXMubmFtZSk7XG4gIGlmKCFub3RlU3RyaW5nKSByZXR1cm47XG4gIHRoaXMucHJvYnMgPSBub3RlU3RyaW5nLnNwbGl0KFwiLFwiKTtcbiAgdGhpcy5wcm9icy5mb3JFYWNoKGZ1bmN0aW9uKHZhbCwgaSl7XG4gICAgaWYoIWlzTmFOKHZhbCkpe1xuICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLicrdGhhdC5uYW1lKycgaW5wdXRbZGF0YS1pbmRleD1cIicraSsnXCJdJykudmFsdWUgPSB2YWw7XG4gICAgfVxuICB9KTtcbn1cblxuRHJ1bS5wcm90b3R5cGUuc2F2ZVJvdyA9IGZ1bmN0aW9uKCl7XG4gIGxvY2FsU3RvcmFnZS5zZXRJdGVtKHRoaXMubmFtZSwgdGhpcy5wcm9icy5qb2luKFwiLFwiKSk7XG59XG5cbm1vZHVsZS5leHBvcnRzID0gRHJ1bTsiLCJtb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uKGJwbSl7XG4gIHJldHVybiAoNjAgKiAxMDAwKSAvIGJwbTtcbn0iLCJ2YXIgU2FtcGxlUGxheWVyID0gcmVxdWlyZSgnb3Blbm11c2ljLXNhbXBsZS1wbGF5ZXInKTtcblxubW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbihhYywgcGF0aCl7XG4gIHZhciBwbGF5ZXIgPSBTYW1wbGVQbGF5ZXIoYWMpO1xuXG4gIHZhciByZXF1ZXN0ID0gbmV3IFhNTEh0dHBSZXF1ZXN0KCk7XG4gIHJlcXVlc3Qub3BlbignR0VUJywgcGF0aCwgdHJ1ZSk7XG4gIHJlcXVlc3QucmVzcG9uc2VUeXBlID0gJ2FycmF5YnVmZmVyJztcblxuICByZXF1ZXN0Lm9ubG9hZCA9IGZ1bmN0aW9uKCkge1xuICAgIGFjLmRlY29kZUF1ZGlvRGF0YShyZXF1ZXN0LnJlc3BvbnNlLCBvbkJ1ZmZlckxvYWRlZCwgb25CdWZmZXJMb2FkRXJyb3IpO1xuICB9O1xuXG4gIHJlcXVlc3Quc2VuZCgpO1xuXG4gIGZ1bmN0aW9uIG9uQnVmZmVyTG9hZGVkKGJ1ZmZlcikge1xuICAgIHBsYXllci5idWZmZXIgPSBidWZmZXI7XG4gIH1cblxuICBmdW5jdGlvbiBvbkJ1ZmZlckxvYWRFcnJvcihlcnIpIHtcbiAgICBjb25zb2xlLmVycm9yKCdvaCBubycsIGVycik7XG4gIH1cblxuICByZXR1cm4gcGxheWVyO1xufSIsInZhciBpbnQyZnJlcSA9IHJlcXVpcmUoXCJpbnQyZnJlcVwiKTtcblxudmFyIFN5bnRoID0gZnVuY3Rpb24ob3NjaWxsYXRvciwgbmFtZSl7XG4gIHRoaXMub3NjaWxsYXRvciA9IG9zY2lsbGF0b3I7XG4gIHRoaXMubmFtZSA9IG5hbWU7XG4gIHRoaXMucHJvYnMgPSBBcnJheSgxNik7XG4gIHRoaXMubm90ZXMgPSBBcnJheSgxNik7XG4gIHRoaXMucGxheWluZyA9IGZhbHNlO1xuICB0aGlzLmluc3RhbGxSb3coKTtcbn1cblxuU3ludGgucHJvdG90eXBlLnBsYXkgPSBmdW5jdGlvbihwb3MsIGFjKXtcbiAgaWYoTWF0aC5yYW5kb20oKSA8IHRoaXMucHJvYnNbcG9zXSl7XG4gICAgdmFyIG5vdGVJbnQgPSB0aGlzLm5vdGVzW3Bvc11bfn4oTWF0aC5yYW5kb20oKSAqIHRoaXMubm90ZXNbcG9zXS5sZW5ndGgpXVxuICAgIGlmKCFub3RlSW50KSBub3RlSW50ID0gMDtcbiAgICB2YXIgZnJlcSA9IGludDJmcmVxKH5+bm90ZUludCwge3RvbmljOiAnQzMnLCBzY2FsZTogJ21ham9yJ30pO1xuICAgIHRoaXMub3NjaWxsYXRvci5mcmVxdWVuY3kuc2V0VmFsdWVBdFRpbWUoZnJlcSwgYWMuY3VycmVudFRpbWUpO1xuICAgIHRoaXMub3NjaWxsYXRvci5zdGFydCgpO1xuICAgIHRoaXMucGxheWluZyA9IHRydWU7XG4gIH0gZWxzZSB7XG4gICAgaWYodGhpcy5wbGF5aW5nKSB0aGlzLm9zY2lsbGF0b3Iuc3RvcChhYy5jdXJyZW50VGltZSk7XG4gICAgdGhpcy5wbGF5aW5nID0gZmFsc2VcbiAgfVxufVxuXG5TeW50aC5wcm90b3R5cGUuaW5zdGFsbFJvdyA9IGZ1bmN0aW9uKCl7XG4gIHZhciB0aGF0ID0gdGhpcztcblxuICB2YXIgc3ludGggPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuICBzeW50aC5zZXRBdHRyaWJ1dGUoXCJjbGFzc1wiLCB0aGlzLm5hbWUpO1xuXG4gIHZhciBzeW50aFByb2JzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcbiAgc3ludGhQcm9icy5zZXRBdHRyaWJ1dGUoXCJjbGFzc1wiLCBcInN5bnRoLXByb2JzXCIpO1xuICBmb3IodmFyIGkgPSAwOyBpIDwgdGhpcy5wcm9icy5sZW5ndGg7IGkrKyl7XG4gICAgdmFyIGNlbGwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiaW5wdXRcIik7XG4gICAgY2VsbC5zZXRBdHRyaWJ1dGUoXCJ0eXBlXCIsIFwidGV4dFwiKVxuICAgIGNlbGwuc2V0QXR0cmlidXRlKFwiY2xhc3NcIiwgXCJwcm9iXCIpXG4gICAgY2VsbC5zZXRBdHRyaWJ1dGUoXCJkYXRhLWluZGV4XCIsIGkpO1xuICAgIGNlbGwuYWRkRXZlbnRMaXN0ZW5lcihcImtleXVwXCIsIGZ1bmN0aW9uIHVwZGF0ZVByb2J6KGUpe1xuICAgICAgdGhhdC5wcm9ic1t+fmUudGFyZ2V0LmRhdGFzZXQuaW5kZXhdID0gcGFyc2VGbG9hdChlLnRhcmdldC52YWx1ZSk7XG4gICAgfSk7XG4gICAgc3ludGhQcm9icy5hcHBlbmRDaGlsZChjZWxsKTtcbiAgfVxuXG4gIHZhciBjbGVhckZpeCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG4gIGNsZWFyRml4LnNldEF0dHJpYnV0ZShcImNsYXNzXCIsIFwiY2ZcIik7XG4gIHN5bnRoUHJvYnMuYXBwZW5kQ2hpbGQoY2xlYXJGaXgpO1xuXG4gIGZvcih2YXIgaSA9IDA7IGkgPCB0aGlzLnByb2JzLmxlbmd0aDsgaSsrKXtcbiAgICB2YXIgY2VsbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJpbnB1dFwiKTtcbiAgICBjZWxsLnNldEF0dHJpYnV0ZShcInR5cGVcIiwgXCJ0ZXh0XCIpXG4gICAgY2VsbC5zZXRBdHRyaWJ1dGUoXCJjbGFzc1wiLCBcIm5vdGVzXCIpXG4gICAgY2VsbC5zZXRBdHRyaWJ1dGUoXCJkYXRhLWluZGV4XCIsIGkpO1xuICAgIGNlbGwuYWRkRXZlbnRMaXN0ZW5lcihcImtleXVwXCIsIGZ1bmN0aW9uIHVwZGF0ZVByb2J6KGUpe1xuICAgICAgdGhhdC5ub3Rlc1t+fmUudGFyZ2V0LmRhdGFzZXQuaW5kZXhdID0gZS50YXJnZXQudmFsdWUuc3BsaXQoXCIsXCIpO1xuICAgIH0pO1xuICAgIHN5bnRoUHJvYnMuYXBwZW5kQ2hpbGQoY2VsbCk7XG4gIH1cblxuICBzeW50aC5hcHBlbmRDaGlsZChzeW50aFByb2JzKVxuXG4gIHZhciBsYWJlbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJzcGFuXCIpO1xuICBsYWJlbC5zZXRBdHRyaWJ1dGUoXCJjbGFzc1wiLCBcImxhYmVsXCIpXG4gIGxhYmVsLnRleHRDb250ZW50ID0gdGhpcy5uYW1lO1xuICBzeW50aC5hcHBlbmRDaGlsZChsYWJlbCk7XG5cbiAgdmFyIHNhdmVCdG4gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiYnV0dG9uXCIpO1xuICBzYXZlQnRuLnRleHRDb250ZW50ID0gXCJzYXZlXCI7XG4gIHNhdmVCdG4uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGZ1bmN0aW9uKCl7XG4gICAgdGhhdC5zYXZlUm93KCk7XG4gIH0pXG4gIHN5bnRoLmFwcGVuZENoaWxkKHNhdmVCdG4pO1xuXG4gIHZhciBsb2FkQnRuID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImJ1dHRvblwiKTtcbiAgbG9hZEJ0bi50ZXh0Q29udGVudCA9IFwibG9hZFwiO1xuICBsb2FkQnRuLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBmdW5jdGlvbigpe1xuICAgIHRoYXQubG9hZFJvdygpO1xuICB9KVxuICBzeW50aC5hcHBlbmRDaGlsZChsb2FkQnRuKTtcblxuICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKHN5bnRoKTtcbn1cblxuU3ludGgucHJvdG90eXBlLnNhdmVSb3cgPSBmdW5jdGlvbihwb3NpdGlvbil7XG4gIGxvY2FsU3RvcmFnZS5zZXRJdGVtKHRoaXMubmFtZStcIi1wcm9ic1wiLCB0aGlzLnByb2JzLmpvaW4oXCIsXCIpKTtcbiAgbG9jYWxTdG9yYWdlLnNldEl0ZW0odGhpcy5uYW1lK1wiLW5vdGVzXCIsIHRoaXMubm90ZXMuam9pbihcInxcIikpO1xufVxuXG5TeW50aC5wcm90b3R5cGUubG9hZFJvdyA9IGZ1bmN0aW9uKHBvc2l0aW9uKXtcbiAgdmFyIHRoYXQgPSB0aGlzO1xuICB2YXIgcHJvYlN0cmluZyA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKHRoaXMubmFtZStcIi1wcm9ic1wiKTtcbiAgaWYoIXByb2JTdHJpbmcpIHJldHVybjtcbiAgdGhpcy5wcm9icyA9IHByb2JTdHJpbmcuc3BsaXQoXCIsXCIpO1xuICB0aGlzLnByb2JzLmZvckVhY2goZnVuY3Rpb24odmFsLCBpKXtcbiAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuJyt0aGF0Lm5hbWUrJyBpbnB1dFtkYXRhLWluZGV4PVwiJytpKydcIl0ucHJvYicpLnZhbHVlID0gdmFsO1xuICB9KTtcblxuICB2YXIgbm90ZXNTdHJpbmcgPSBsb2NhbFN0b3JhZ2UuZ2V0SXRlbSh0aGlzLm5hbWUrXCItbm90ZXNcIik7XG4gIGlmKCFub3Rlc1N0cmluZykgcmV0dXJuO1xuICB0aGlzLm5vdGVzID0gbm90ZXNTdHJpbmcuc3BsaXQoXCJ8XCIpLm1hcChmdW5jdGlvbihjZWxsKXtcbiAgICByZXR1cm4gY2VsbC5zcGxpdChcIixcIik7XG4gIH0pO1xuICB0aGlzLm5vdGVzLmZvckVhY2goZnVuY3Rpb24odmFsLCBpKXtcbiAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuJyt0aGF0Lm5hbWUrJyBpbnB1dFtkYXRhLWluZGV4PVwiJytpKydcIl0ubm90ZXMnKS52YWx1ZSA9IHZhbC5qb2luKFwiLFwiKTtcbiAgfSk7XG59XG5tb2R1bGUuZXhwb3J0cyA9IFN5bnRoOyJdfQ==
